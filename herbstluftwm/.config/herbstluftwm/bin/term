#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl
[ $TRACE ] && CHILD="bin/term $@" . $PARENT

# herbstluftwm
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ..................................................................... Terminal

# Usage: term [<title>] [ FLOAT | MAX | FONTSIZE <size> | FORTUNE | STACK | TR | WAIT ] [[SHELL] <command>]
#        title (and default name string)
#        FLOAT, MAX, STACK herbstluftwm hooks for setting layout and geometry
#        TR, disable urxvt pseudo transparency
#        WAIT, for process to complete before returning
#        SHELL <command>, for simpler unquoted command passing
# Note:  title may not contain spaces, use hyphen or underscore in place

TERM=urxvt

# first parameter may be title
if [ "$1" ] ;then
  if echo "$1" | egrep -qv 'FLOAT|FORTUNE|MAX|STACK|SHELL' ;then
    title="-title \"$1\""
    shift
  fi
fi

while [ "$1" ]
do
  case $1 in
    FLOAT) name='-name float'
           geometry='-geometry 1024x600+0+0'
           shift ;;

    MAX) name='-name max'
         shift ;;

    FONTSIZE) fn="-fn 'xft:PragmataPro:size=$2'"
              shift 2 ;;

    FORTUNE) touch /tmp/term:fortune
             shift ;;

    STACK) stack=true
           shift ;;

    TR) tr='+tr'
        shift ;;

    WAIT) foreground=true
          shift ;;

    SHELL) shift
           process="$@"
           # open shell commands in interactive mode
           [ "$*" ] && cmd="-e zsh -ic '$@'" || cmd='-e zsh'
           break ;;

    *) process="$@"
       cmd="-e $@"
       break ;;
  esac
done

if [ -z "$name" ] ;then
  [ "$title" ] && name="-name ${title#* }"
fi

if [ $stack ] ;then
  $TERM $title $name $geometry $tr $cmd
else
  focus $TERM $title $name $geometry $tr $fn $cmd
fi

# wait for process to complete
if [ $foreground ] ;then
  pwait "$process"
fi

# vim: set ft=sh: #
