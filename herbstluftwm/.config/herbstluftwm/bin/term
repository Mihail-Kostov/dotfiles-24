#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl
[ $TRACE ] && CHILD="bin/term $@" . $PARENT

# herbstluftwm
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ..................................................................... Terminal

# Usage: term [<title>] [ FLOAT | MAX | FORTUNE | STACK | TABBED | TR | VISIBLE | WAIT ] [[SHELL] <command>]
#        title (and default name string)
#        FLOAT, MAX, STACK herbstluftwm hooks for setting layout and geometry
#        TR, disable urxvt pseudo transparency
#        VISIBLE, wait for window visibility
#        WAIT, for process to complete before returning
#        SHELL <command>, for simpler unquoted command passing
# Note:  title may not contain spaces, use hyphen or underscore in place

SHELL=/usr/bin/dash
TERM=urxvt

# first parameter may be title
if [ "$1" ] ;then
  if echo "$1" | egrep -qv 'FLOAT|FORTUNE|MAX|STACK|SHELL' ;then
    title="-title $(echo $1 | sed 's/ /_/g')"
    shift
  fi
fi

while [ "$1" ]
do
  case $1 in
    FLOAT) name='-name float'
           geometry='-geometry 1024x600+0+0'
           shift ;;

    MAX) name='-name max'
         shift ;;

    FORTUNE) touch /tmp/term:fortune
             shift ;;

    STACK) stack=true
           shift ;;

    TABBED) tabbed='-pe tabbed'
            shift ;;

    TR) tr='+tr'
        shift ;;

    VISIBLE) visible=true
             shift ;;

    WAIT) wait=true
          shift ;;

    SHELL) shift
           process="$@"
           [ "$*" ] && cmd="-e $SHELL -c '$@'"
           break ;;

    *) process="$@"
       cmd="-e $@"
       break ;;
  esac
done

if [ -z "$name" ] ;then
  [ "$title" ] && name="-name ${title#* }"
fi

if [ $stack ] ;then
  $TERM $title $name $geometry $tabbed $tr $cmd
else
  focus $TERM $title $name $geometry $tabbed $tr $cmd
fi

if [ $visible -a "$title" ] ;then
  xdotool search --sync --onlyvisible --limit 1 --classname "${title#* }"
fi

if [ $wait ] ;then
  pwait "$process"
fi

# vim: set ft=sh: #
