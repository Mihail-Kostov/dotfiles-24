#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Dev
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ....................................................................... Editor

# va va voom
SHELL=/usr/bin/dash
if console ;then
  vim $@
  exit
fi

if [ -z $1 ] ;then
  focus vim -g /tmp/scratch
else
  # dmenu configs escapes spaces BUT file="$@" evals differently than.. ??
  file=$(echo $@)
  if [ ! -e $1 ] ;then
    focus vim -g $file
  elif [ -w $1 ] ;then
    focus vim -g $file
  else
    focus sudo -s vim -g $file
    # chown root history to prevent syncing errors
    # find $HOME/.vim/backups -user root -exec sudo chown -c $USER\:users {} \;
  fi
fi
hlwm && herbstclient set_layout max

# syncthing housekeeping
find $HOME/.vim/backups -size 0 -exec rm -fv {} \;
find $HOME/.vim/backups -user root -exec sudo chown -c $USER:users {} \;
# avoid nfs mounts
find $HOME -path $HOME/Maildir -prune -o -name '.viminf*.tmp' -exec rm -fv {} \;

# vim: set ft=sh: #
