#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Dev
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ....................................................................... Editor

# va va voom
SHELL=/usr/bin/dash
console || focus=focus

if [ -z $1 ] ;then
  file=$(find -type f 2>/dev/null | grep -v '.deprecated' | fzf)
  [ "$file" ] || exit
  $focus vim -g $file
else
  # dmenu configs escapes spaces BUT file="$@" evals differently than.. ??
  file=$(echo $@)
  if [ ! -e $1 ] ;then
    $focus vim -g $file
  elif [ -w $1 ] ;then
    $focus vim -g $file
  else
    $focus sudo -s vim -g $file
    # chown root history to prevent syncing errors
    # find $HOME/.vim/backups -user root -exec sudo chown -c $USER\:users {} \;
  fi
fi
hlwm && herbstclient set_layout max

# syncthing housekeeping
find $HOME/.vim/backups -size 0 -exec rm -fv {} \;
find $HOME/.vim/backups -user root -exec sudo chown -c $USER:users {} \;
# avoid nfs mounts
server && find $HOME/Maildir -name '.viminf*.tmp' -exec rm -fv {} \;

# vim: set ft=sh: #
