#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Dev
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ....................................................................... Editor

# Usage: v [-f] [file]..

# va va voom
SHELL=/usr/bin/dash
hlwm && [ -e $DYNAMIC ] && focus=focus

if [ "$1" = '-f' ] ;then
  fg=-f
  shift
fi

if [ -z $1 ] ;then
  file=$(find -type f 2>/dev/null | filter | fzf --multi)
  [ "$file" ] || exit
  $focus vim -g $fg $file
else
  # dmenu configs escapes spaces BUT file="$@" evals differently than.. ??
  file=$(echo $@)
  if [ ! -e $1 ] ;then
    unset sudo
  elif [ -w $1 ] ;then
    unset sudo
  else
    sudo='sudo -s'
  fi
fi
hlwm && herbstclient set_layout max
count=$(echo $file | wc -w)
[ $count -gt 1 ] && notify 'Gvim' "$count files to edit"
eval $focus $sudo vim -g $fg $file

# syncthing housekeeping (unless vim fg, housekeeping is staggered)
find $HOME/.vim/backups -size 0 -exec rm -fv {} \;
find $HOME/.vim/backups -user root -exec sudo chown -c $USER:users {} \;
# avoid nfs mounts
server && find $HOME/Maildir -name '.viminf*.tmp' -exec rm -fv {} \;

# vim: set ft=sh: #
