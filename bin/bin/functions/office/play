#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Office
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ................................................................. Media player

# Usage: play <url> | <path> [<title>]

youtube=/tmp/youtube-dl

blackboard
toggle compton off
# play media (see rox, dmenu movies, dmenu series, browsers..)
[ "$2" ] && title=$2 || title=${1##*/}
if arm; then
  # youtube playback on raspberry pi architecture is unsupported
  if echo $1 | grep -q http ;then
    rm -f ${youtube:-/tmp/youtube-dl}.*
    term youtube-dl FLOAT SHELL "ditto youtube-dl "$1" && youtube-dl -o $youtube "$1""
    pwait "$youtube"
    title=$youtube
    video=$youtube.*
  fi

  geometry=$(dmenu geometry "$title") || exit
  [ $video ] || video=$(find "$1" -regextype posix-extended -regex '.*(mkv|Mkv|mp4|Mp4|avi|divx|m4v|wmv)' | grep -v sample)
  notify "$title" '1/2  Speed\n+/-  Volume\nm/n  Subtitles'
  # syncthing cpu usage can exacerbate video stuttering
  systemd stop syncthing@$USER

  # omxplayer keyboard shortcuts only available through terminal emulator
  # eval term 'omxplay' BLACKBOARD omxplayer $geometry --subtitles "${video%.*}.srt" --align center "$video"
  eval term 'omxplay' BLACKBOARD omxplayer $geometry --align center "$video"
  echo "$title -> $video" >>/tmp/omxplay.log
  pwait "$video"
  systemd start syncthing@$USER
else
  notify "$title" '1/2  Contrast\n3/4  Brightness\n5/6  Gamma\n7/8  Saturation\n9/0  Volume\n-/+  &lt;Ctrl&gt; Audio Delay\nv/j  Subtitles'
  focus frame
  mpv --vf=eq "$1" >/dev/null 2>&1
  # delete accidental screenshots
  rm -f $HOME/mpv-shot*.jpg
fi
# refresh panel title on close
focus window
toggle compton on

# vim: set ft=sh: #
