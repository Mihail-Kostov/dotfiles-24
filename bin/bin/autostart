#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# X11 Startup
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ....................................................... Window manager restart

# tag
web=1
chat=2

killall -TERM imapfilter 2>/dev/null
killall -TERM offlineimap 2>/dev/null

# ....................................................... Session initialization

rm -f $HOME/.msmtpqueue/.lock 2>/dev/null
rm -f $HOME/.nzbget.paused 2>/dev/null
rm -f /tmp/setroot 2>/dev/null
rm -f /srv/http/tt-rss/lock/* 2>/dev/null

gnome-keyring-daemon -s --components=pkcs11,secrets,ssh,gpg &
# laptop && synclient VertEdgeScroll=1 &
# laptop && synclient TapButton1=1 &
pidof gpg-agent >/dev/null \
|| gpg-agent --homedir /home/shum/.gnupg --use-standard-socket --daemon 2>/tmp/gpg-agent.log &
ipfilter &
xrdb -merge $HOME/.Xresources &

# ........................................................... Daemons and caches

# pidof dunst || dunst 2>/dev/null &
pidof mpd || sleep 2 && mpd &
pidof nzbget || nzbget --daemon &
pidof urxvtd || urxvtd -q -o -f &
# pidof xflux || xflux -l 45.4 -g -75.7
dmenu movies cache

# ....................................................... Desktop initialization

# enable cut and paste
# autocutsel -fork &
autocutsel -selection PRIMARY -fork &

draw compton
# if server ;then
#   dispread -v -d2 -c1 -yl "-P0.012987012987,1,4.11345646438" \
#           -k "L3007WFPHC 2014-02-04 2.2 M-S 3xCurve+MTX.cal" \
#           -s "L3007WFPHC 2014-02-04 2.2 M-S 3xCurve+MTX" 2>/dev/null
#   dispread -v -d1 -c1 -yl "-P0.0195488721805,1,4.07630522088" \
#           -k "L 2209WA 2014-02-04 2.2 M-S 3xCurve+MTX.cal" \
#           -s "L 2209WA 2014-02-04 2.2 M-S 3xCurve+MTX" 2>/dev/null
# fi
server && dmenu screensaver on
unclutter -idle 1 -jitter 2 -root &

# ................................................................. Systray apps

ps -ef | grep autokey-gtk | grep -qv grep || autokey-gtk --verbose >/tmp/autokey.log 2>/dev/null &
pidof gpaste-client >/dev/null || gpaste-client &
pidof xfce4-power-manager >/dev/null || xfce4-power-manager 2>/dev/null &

# ................................................................ Terminal apps

[ $TRACE ] && term 'Trace' tail -f /tmp/herbstluftwm.log
if [ -e $HOME/.irc ] ;then
  if server ;then
    herbstclient focus_monitor 1
    # wait for window visibility before switching monitors, for urxvt font handling
    term 'IRC' VISIBLE weechat
    herbstclient focus_monitor 0
  else
    switch tag "$chat"
    term 'IRC' VISIBLE weechat
  fi
fi
[ -e $HOME/.mail ] && term 'Mail' alot

# .................................................................. Window apps

server && thedarnedestthing
server && vimwiki
switch tag "$web"
# qutebrowser &
vimbt
# xdotool search --screen 0 --classname --onlyvisible --sync 'chromium' >/dev/null

# .............................................................. Cleanup desktop

# autocutsel leaves a small square of black pixels in the bottom right corner
(xdotool search --sync --onlyvisible --name autocutsel windowunmap) &

# vim: set ft=sh: #
