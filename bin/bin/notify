#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# X11 Desktop
# ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂

# ${_colors_} defined in env

# ..................................................................... Notifier

usage() {
  echo "usage: [time=seconds]  $(basename $0)  [console] [low | normal | critical] \"<summary>\" [\"<body>\"]"
  exit 1
}

# enable cron notifications, see .xinitrc
if [ -r "$HOME/.dbus/Xdbus" ]; then
  . "$HOME/.dbus/Xdbus"
fi

if [ "$1" = console ] ;then
  console=true
  shift
fi

if echo "$1" | egrep -qE '^(low|normal|critical)$' ;then
  urgency="-u $1"
  shift
fi
echo "$(timestamp) $USER:${urgency#-u} \"$1\" \"$2\"" >>/tmp/notify.log

if console || [ $console ] ;then
  [ "$2" ] && echo "${_YELLOW_}-> $1\n${_CYAN_} -> $2${_nocolor_}" ||
              echo "${_YELLOW_}-> $1${_nocolor_}"
else
  [ $time ] && expire="--expire-time=$(( $time * 1000 ))"
  case $# in
    0) usage ;;

    1) if [ $(echo "$1" | wc -l) -eq 1 ] ;then
         DISPLAY=:0 notify-send $expire $urgency --icon=help-info "$1" &
       else
         # set first line as heading for a single multiline message
         heading=$(echo "$1" | sed '2,$d')
         body=$(echo "$1" | sed '1d')
         DISPLAY=:0 notify-send $expire $urgency --icon=help-info "$heading" "$body" &
       fi ;;

    2) DISPLAY=:0 notify-send $expire $urgency --icon=help-info "$1" "$2" & ;;
    *) usage ;;
  esac
fi

# vim: set ft=sh: #
